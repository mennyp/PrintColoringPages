<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"> 
<html>
    <head> 
        <meta http-equiv="content-type" content="text/html; charset=utf-8"> 
        <title>חיפוש דפי צביעה</title>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
        <script type="text/javascript">
            function ImageSourcetoPrint(source) {
                return  "<html><head>" +
                        "<style>img{max-height:900px;max-width:800px;height:auto;width:auto;}</style>" +
                        "<script>function step1(){" +
                        "setTimeout('step2()', 1000);}" +
                        "function step2(){window.print();}" +
                        "</scri" + "pt></head><body onload='step1()'>" +
                        "<img src='" + source + "' /></body></html>";
            }
            function ImagePrint(source) {
                Pagelink = "about:blank";
                var pwa = window.open(Pagelink, "_new");
                pwa.document.open();
                pwa.document.write(ImageSourcetoPrint(source));
                pwa.document.close();
            }
            function addItemToPage(id, name, encodingFormat, contentSize, contentUrl, thumbnailUrl) {
                $('#' + id).append('<div class="col-md-2"><p>\'' + name + ' | ' + encodingFormat + ' | ' +
                    contentSize + '\'</p><a href="#" onclick="ImagePrint(\'' +
                    contentUrl + '\'); return false;"><img src="' + thumbnailUrl + '"/></a></div>');
            }
            var bing_key = "3e160d63ee4f4a2ea54f4dd0eedbbaf3";
            var start = 0;
            var offset = 10;
            function searchFromBing(from, to, query, picSize, callback) {
                // BING implementation
                // https://azure.microsoft.com/en-us/try/cognitive-services/

                var bing_url = "https://api.cognitive.microsoft.com/bing/v7.0/images/search?" +
                    "safeSearch=Strict" +
                    "&Color=Monochrome" +
                    "&size=" + picSize +
                    "&count=" + to +
                    "&offset=" + from +
                    "&q=" + query;
                console.log(bing_url);
                $.ajax({
                    url: bing_url,
                    headers: {
                        "Ocp-Apim-Subscription-Key": bing_key
                    },
                    async: true,
                    success: function(result){
                        console.log(result);
                        var id = 1;
                        $.each(result.value, function(index, item) {
                            if (index % 6 == 0) {
                                id = id + 1;
                                $('#result').append('<div class="row" id="' + id + '"></div>');
                            }
                            addItemToPage(id, item.name, item.encodingFormat, sizeToText(parseInt(item.contentSize.split('B')[0])), item.contentUrl, item.thumbnailUrl);
                        });
                        var res = {
                            total: result.totalEstimatedMatches,
                            nextOffset: result.nextOffset,
                            currentOffset: result.currentOffset
                        };
                        if (callback)
                            callback(res);
                    }
                });
            }

            function sizeToText(contentSize) {
                if(contentSize < 10000){
                   return 'low';
                }
                else if(contentSize < 50000){
                    return 'med-low';
                }
                else if(contentSize < 100000){
                    return 'med';
                }
                else if(contentSize < 200000){
                    return 'high';
                }
                else {
                    return 'very-high';
                }
            }

            function searchFromGoogle(from, rowSize, query, picSize) {
                // GOOGLE implementation
                // https://developers.google.com/custom-search/json-api/v1/overview
                //imgSize: icon, small, medium, large, xlarge, xxlarge, or huge.
                var cx = "012799103566678627508:cbss51dvbjh";
                 var key = "AIzaSyD2ACDPxA-6qMy11WnUFuVCebjd8PU2IEs";
                 var url = "https://www.googleapis.com/customsearch/v1" +
                     "?q=" + query +
                     "&cx=" + cx +
                     "&key=" + key +
                     "&start=" + from +
                     "&num=" + rowSize +
                     "&imgColorType=gray&imgType=lineart&imgSize=" + picSize.toLowerCase() + "&searchType=image&safe=high";
                 console.log(url);
                 $.ajax({
                     url: url,
                     async: true,
                     success: function(result){
                         console.log(result);
                         var id = "result" + result.queries.request[0].startIndex;
                         $('#result').append('<div class="row" id="' + id + '"></div>')
                         $.each(result.items, function(index, item) {
                             //$('#' + id).append('<div class="col-md-1"><a href="#" onclick="ImagePrint(\'' +
                               //  item.link + '\'); return false;"><img src="' + item.image.thumbnailLink + '"/></a></div>');
                             addItemToPage(id, item.title, item.fileFormat, sizeToText(parseInt(item.image.byteSize)), item.link, item.image.thumbnailLink);
                         });
                     }
                 });
            }

            function handleResult(res) {
                console.log(res);
                if (res) {
                    $("#totalSpan").show();
                    $("#totalSpan").html('סה\"כ: ' + res.total + ' תוצאות.');
                    if (res.currentOffset == 0) {
                        $("#prevBtn").hide();
                    } else {
                        $("#prevBtn").show();
                    }
                    $("#currentPosSpan").show();
                    $("#currentPosSpan").html('דף ' + (start + offset) / offset);
                    if (res.nextOffset == res.total) {
                        $("#nextBtn").hide();
                    } else {
                        $("#nextBtn").show();
                    }
                }
            }
        </script>
        <script>
        $(document).ready(function(){
            $("#totalSpan").hide();
            $("#prevBtn").hide();
            $("#currentPosSpan").hide();
            $("#nextBtn").hide();
            $("#searchBtn").click(function(){
                start = 0;
                var query = $("#search").val();
                $("#result").html("לחץ על תמונה להדפסה");
                var picSize = $("input[name='picSize']:checked").val();
                searchFromBing(start, offset, query, picSize, handleResult);
            });
            $("#nextBtn").click(function(){
                start += offset;
                $("#result").html("לחץ על תמונה להדפסה");
                var query = $("#search").val();
                var picSize = $("input[name='picSize']:checked").val();
                searchFromBing(start, offset, query, picSize, handleResult);
            });
            $("#prevBtn").click(function(){
                start -= offset;
                $("#result").html("לחץ על תמונה להדפסה");
                var query = $("#search").val();
                var picSize = $("input[name='picSize']:checked").val();
                searchFromBing(start, offset, query, picSize, handleResult);
            });
            $("#search").val("פסח");
        });
        </script>
        <style>
            .col-md-2{
                border: 1px solid black;
            }
            img {
                max-width:  150px;
                height:     auto;
                width:      auto;
            }
            .siteFooterBar {
                position: fixed;
                z-index: -1;
                bottom: 10px;
                left: 10px;
                padding-top: 10px;
                width: 200px;
                box-shadow: 0px 0px 25px rgb(207, 207, 207);
                background: #F3F3F3;
            }

            .content {
                color: #9B9B9B;
                display: block;
                margin: 0px auto;
                text-align: center;
                font: 25px Georgia, "Times New Roman", Times, serif;
                font-size: 14px;
            }
            .foot {
                display:inline;
                line-height: 50px;
            }
            .content img {
                height:50px;
                width: 50px;
                float:left;
            }
        </style>
    </head>
    <div class="content" style="position: absolute; right: 0px">בס"ד</div>
    <body style="direction: rtl; display: flex; min-height: 100vh; flex-direction: column;">
        <div style="text-align: center">
            <h1>אתר לחיפוש דפי צביעה להדפסה</h1>
        </div>
        <div style="width: 100%; display: flex; height: 30px; align-content: center; justify-content: center">
            <div style="display: flex; flex-direction: row; align-content: center" >
                <H4 style="margin:5px">חיפוש:</H4>
                <input id="search" type="text" style="text-align: center"/>
                <button id="searchBtn">חפש</button>
                <H4 style="margin:5px 40px 5px 0px">גודל:</H4>
                <p style="margin: 5px">
                <input type="radio" name="picSize" value="Small" >קטן</input>
                <input type="radio" name="picSize" value="Medium">בינוני</input>
                <input type="radio" name="picSize" value="Large" checked="checked">גדול</input>
                <input type="radio" name="picSize" value="Wallpaper">פוסטר</input>
                <input type="radio" name="picSize" value="All">הכל</input>
                </p>
            </div>
        </div>
        <div style="width: 100%; margin-top: 20px; display: flex; overflow: scroll; flex-direction: column; justify-content: center; horiz-align: center">
            <div id="result" style="text-align: center;">תוצאות יוצגו כאן</div>
            <div style="display: flex; flex-direction: row;justify-content: center;">
                <span id="totalSpan" style="margin: 5px"></span>
                <button id="prevBtn">הקודם</button>
                <span id="currentPosSpan" style="margin: 5px"></span>
                <button id="nextBtn">הבא</button>
            </div>
        </div>
        <div class="siteFooterBar">
            <div class="content">
                <!--<img src="http://i.imgur.com/nuRmQJX.png" >-->
                <div >בשורות טובות! ממשפחת פנחסוב.</div>
                <div >להצעות ייעול מוזמנים לשלוח מייל ל - mpinhaso@gmail.com</div>
            </div>
        </div>
    </body> 
</html>
